


pipeline{
agent any


stages {
   stage('Upload a WAR File') {
         steps {
             script {
             def JavaAppURL="https://github.com/venualonea1/javaapp.git"
                 
                        checkout([$class: 'GitSCM',branches: [[name: 'master']],
                        doGenerateSubmoduleConfigurations: false,extensions: [[$class: 'CleanCheckout']],
                        userRemoteConfigs: [[url: 'https://github.com/venualonea1/javaapp.git']]])
                         
                         
        }    
                 echo env.STAGE_NAME
                 echo '=========== Uploaded a War=============='       
                        
                }
            }
            stage('building the Maven Package WebApp'){
               steps{
                  script{
                     
                     withEnv(["PATH+MVN=${tool 'mvn_home'}/bin"]){
            sh '''
               mvn -f pom.xml package
            '''
        }
                  
                  }
               }
            
            }
            stage('Deploying theWebApp to tomcat'){
            steps{
               script{
                  MACHINE_NAME='3.22.119.153'
                  DEPLOYPATH='/opt/Tomee-instance01/webapps'
                  Startup="/opt/Tomee-instance01/bin/startup.sh"
                  
                  echo "Deploying the tomcat"
                  sh "cd ${WORKSPACE}/target/;scp test.war ubuntu@18.220.77.194:/opt/Tomee-instance01/webapps"
                  sh "ssh -i ~/.ssh/id_rsa.pub ubuntu@${MACHINE_NAME} ${Startup}"
                  
                  
                  
               }
            }
            
            }
        }
      }

